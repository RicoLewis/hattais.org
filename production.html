<!DOCTYPE html>


<!-- SAFE V74 -->
<!-- Ajouter les RDV -->
<!-- ajouter les description lors de RDV et PRISE EN CHARGE -->

<html lang="fr">
<head>
    <meta charset="UTF-8">
		<title>Production HATTAIS</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js"></script>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<link rel="stylesheet" href="lib.css">
</head>
<body>

<table cellspacing="0" cellpadding="5" style='margin:auto'>
	<form action="https://script.google.com/macros/s/AKfycbyJ7_TTp1UNBFVGB4XNgrbquEN_gY-5n4GhtmqqjFHCzRLidSDq/exec" id="production_form" method="post">
		<input type="hidden" name="n_form" value="prod">
		<tr align='center'>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				<h3 id="id_titre">FICHE D'INTERVENTION :</h3>
			</td>
		</tr>
		
		<tr align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input class="new_sav" type="radio" id="01a" name="raison" value="new_sav" checked onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input class="retour_sav" type="radio" id="02a" name="raison" value="retour_sav" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input class="etude" type="radio" id="03a" name="raison" value="etude" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="01b" style='line-height:130%'>Nouveau SAV</label>
				<br>
				<label for="02b" style='line-height:130%'>Retour SAV</label>
				<br>
				<label for="03b" style='line-height:130%'>Etude DEVIS</label>
			</td>
		</tr>
		
		<tr align='center'>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				 <hr width='500px'>
				 <U><strong id="id_info">INFORMATIONS :</strong></U>
			</td>
		</tr>
		
		<tr class="cl_bfiche" align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input class="bfiche" id="id_bfiche" type="checkbox" name="bfiche" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="bfiche">Sans N° de fiche.</label>
			</td>
		</tr>
		
		<tr align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<label class="fiche" for="fiche">Numero de fiche :</label>
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<input class="fiche" type="text" id="id_inp_fiche" name="fiche" size="10" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
		</tr>
		<tr class="cl_adresse" align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<label for="adresse">Adresse :</label>
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<input type="text" id="id_inp_adresse" name="adresse" size="30" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
		</tr>
		
		<tr class="cl_type" align='center'>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				 <hr width='500px'>
				 <U><strong id="id_type">TYPE DE SAV :</strong></U>
			</td>
		</tr>
		
		<tr class="cl_type" align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input type="radio" id="11" name="type" value="Dépannage" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="12" name="type" value="Inter sur RDV" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="13" name="type" value="Changement de Nom" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="14" name="type" value="Création de Badge/Émetteur" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="11" style='line-height:130%'>Dépannage</label>
				<br>
				<label for="12" style='line-height:130%'>Inter sur RDV</label>
				<br>
				<label for="13" style='line-height:130%'>Changement de Nom</label>
				<br>
				<label for="13" style='line-height:130%'>Création de Badge/Émetteur</label>
			</td>
		</tr>
		
		<tr class="cl_auteur" align='center' hidden>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				 <hr width='500px'>
				 <U><strong id="id_auteur">AUTEUR DU RETOUR :</strong></U>
			</td>
		</tr>
		
		<tr class="cl_auteur" align='center' hidden>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input type="radio" id="21a" name="auteur" value="Accueil" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="22a" name="auteur" value="David" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="23a" name="auteur" value="Clément" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="24a" name="auteur" value="Eric" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="25a" name="auteur" value=" " onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="21a" style='line-height:130%'>Accueil</label>
				<br>
				<label for="22a" style='line-height:130%'>David</label>
				<br>
				<label for="23a" style='line-height:130%'>Clément</label>
				<br>
				<label for="24a" style='line-height:130%'>Eric</label>
				<br>
				<label for="25a" style='line-height:130%'>Autre :</label>
				<input class="cl_auteur_input_autre" type="text" id="25c" name="inp_auteur" size="10" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
		</tr>
		
		<tr class="cl_motif" align='center' hidden>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				 <hr width='500px'>
				 <U><strong id="id_motif">MOTIF DU RETOUR :</strong></U>
			</td>
		</tr>
		
		<tr class="cl_motif" align='center' hidden>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input type="radio" id="31a" name="motif" value="Relance" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="32a" name="motif" value="Info" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="33a" name="motif" value="Prise en charge" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="34a" name="motif" value="En cours" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="35a" name="motif" value="RDV" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="36a" name="motif" value="Traité" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
				<br>
				<input type="radio" id="37a" name="motif" value="Annulation" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="31a" style='line-height:120%'>Relance</label>
				<br>
				<label for="32a" style='line-height:130%'>Info</label>
				<br>
				<label for="33a" style='line-height:130%'>Prise en charge</label>
				<br>
				<label for="34a" style='line-height:130%'>En cours</label>
				<br>
				<label for="35a" style='line-height:130%'>RDV</label>
				<br>
				<label for="36a" style='line-height:130%'>Traité</label>
				<br>
				<label for="37a" style='line-height:130%'>Annulation</label>
			</td>
		</tr>
		
		<tr align='center'>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				 <hr width='500px'>
			</td>
		</tr>
		<tr class="clRdv" id="id_rdv" align='center' hidden>
			<td colspan="2" width='1000px' style='vertical-align:middle'>
				<label for="description">RDV :</label>
				<br>
				<input type="datetime-local" id="id_inp_rdv" name="rdv">
				<hr width='500px'>
			</td>
		</tr>
		<tr class="clDescription" align='center'>
			<td colspan="2" width='1000px' style='vertical-align:middle'>
				<label for="description">Description :</label>
				<br>
				<textarea id="description" name="description" rows="10" cols="60"></textarea>
			</td>
		</tr>
		
		
		
		
		<tr class="cl_b_pj" align='center'>
			<td width='500px' style='text-align:right;vertical-align:middle'>
				<input class="cl_b_pj_chk" type="checkbox" name="bPJ" onchange="hidding()" onkeypress="refuserToucheEntree(event)">
			</td>
			<td width='500px' style='text-align:left;vertical-align:middle'>
				<label for="bfiche">Pièce(s) Jointe(s) ?</label>
			</td>
		</tr>
		<input id="production_submit" type="submit" hidden>
	</form>
	
	<tr class="cl_pj" align='center' hidden>
		<td colspan="2" style='text-align:center;vertical-align:middle'>
			<form action="https://script.google.com/macros/s/AKfycbyJ7_TTp1UNBFVGB4XNgrbquEN_gY-5n4GhtmqqjFHCzRLidSDq/exec" id="form_pj" method="post">
				<div id="files">
					<input type="hidden" name="n_form" value="pj">
					<input type="hidden" name="nbrData" id="nbrData" value="1">
					<div id="data1"></div>
					<input name="file1" id="pj1" type="file" onchange="savePJ(this)">
				</div>
				<input id="pj_submit" type="submit" hidden>
			</form>
		</td>
	</tr>
	
	
	<tr align='center'>
			<td colspan="2" style='text-align:center;vertical-align:middle'>
				<button type="submit" id="submit-form" name="envoyer" >Envoyer</button>
			</td>
		</tr>
</table>
<br><br><br><br><br><br>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script type="text/javascript" src="./jquery.serializeObject.min.js"></script>

<script type="text/javascript">
	document.getElementById("id_inp_fiche").value = $_GET("fiche");
	if($_GET("raison") == 'retour_sav') {
		document.getElementById("01a").checked = false;
		document.getElementById("02a").checked = true;
		hidding();
	}
	
	function $_GET(param) {
		var vars = {};
		window.location.href.replace( location.hash, '' ).replace( 
			/[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
			function( m, key, value ) { // callback
				vars[key] = value !== undefined ? value : '';
			}
		);

		if ( param ) {
			return vars[param] ? vars[param] : null;	
		}
		return vars;
	}

    function hidding() {
		document.getElementById("id_titre").style = "color:black";
		if($('.new_sav').is(":checked")) {
			document.getElementById("id_auteur").style = "color:black";
			document.getElementById("21a").checked = false;//\
			document.getElementById("22a").checked = false;// \
			document.getElementById("23a").checked = false;//  }-AUTEUR
			document.getElementById("24a").checked = false;// /
			document.getElementById("25a").checked = false;///
			document.getElementById("id_motif").style = "color:black";
			document.getElementById("31a").checked = false;//\
			document.getElementById("32a").checked = false;// \
			document.getElementById("33a").checked = false;//  \
			document.getElementById("34a").checked = false;//   }-MOTIF
			document.getElementById("35a").checked = false;//  /
			document.getElementById("36a").checked = false;// /
			document.getElementById("37a").checked = false;///
			
			$(".cl_adresse").show();
			$(".cl_bfiche").show();
			$(".cl_type").show();
			$(".cl_auteur").hide();
			$(".cl_motif").hide();
		}
        else if($('.retour_sav').is(":checked")) {
            //$(".cl_adresse").prop("disabled", true);
			$(".cl_adresse").hide();
			$(".cl_bfiche").hide();
			$(".cl_type").hide();
			$(".cl_auteur").show();
			$(".cl_motif").show();
			$(".fiche").show();
			$(".bfiche").prop("checked", false);
			document.getElementById("id_type").style = "color:black";
			document.getElementById("11").checked = false;//\
			document.getElementById("12").checked = false;// \
			document.getElementById("13").checked = false;//  }-TYPE
			document.getElementById("14").checked = false;// /
			if(document.getElementById("35a").checked) {  // RDV
				$(".clRdv").show();
				$(".clDescription").hide();
				$(".cl_b_pj").hide();
				}
			else {
				$(".clRdv").hide();
				$(".clDescription").show();
				$(".cl_b_pj").show();
				}
			}
        else {
			//$(".cl_adresse").prop("disabled", false);
			$(".cl_adresse").show();
			$(".cl_bfiche").show();
			$(".cl_type").hide();
			$(".cl_auteur").hide();
			$(".cl_motif").hide();
			document.getElementById("id_type").style = "color:black";
			document.getElementById("11").checked = false;//\
			document.getElementById("12").checked = false;// \
			document.getElementById("13").checked = false;//  }-TYPE
			document.getElementById("14").checked = false;// /
			document.getElementById("id_auteur").style = "color:black";
			document.getElementById("21a").checked = false;//\
			document.getElementById("22a").checked = false;// \
			document.getElementById("23a").checked = false;//  }-AUTEUR
			document.getElementById("24a").checked = false;// /
			document.getElementById("25a").checked = false;///
			document.getElementById("id_motif").style = "color:black";
			document.getElementById("31a").checked = false;//\
			document.getElementById("32a").checked = false;// \
			document.getElementById("33a").checked = false;//  \
			document.getElementById("34a").checked = false;//   }-MOTIF
			document.getElementById("35a").checked = false;//  /
			document.getElementById("36a").checked = false;// /
			document.getElementById("37a").checked = false;///
			}
	<!-- INFORMATIONS -->
		var bInfo = true;
		<!-- fiche -->
		if(!document.getElementById("id_bfiche").checked && document.getElementById("id_inp_fiche").value == "") bInfo = false;
		<!-- adresse -->
		if((document.getElementById("01a").checked || document.getElementById("03a").checked)&& document.getElementById("id_inp_adresse").value == "") bInfo = false;
		if(bInfo) document.getElementById("id_info").style = "color:black";
	<!-- TYPE -->
		if(document.getElementById("11").checked || document.getElementById("12").checked || document.getElementById("13").checked || document.getElementById("14").checked) {
			document.getElementById("id_type").style = "color:black";
		}
	<!-- AUTEUR -->
		if(document.getElementById("21a").checked || document.getElementById("22a").checked || document.getElementById("23a").checked || document.getElementById("24a").checked || document.getElementById("25a").checked) {
			document.getElementById("id_auteur").style = "color:black";
		}
	<!-- MOTIF -->
		if(document.getElementById("31a").checked || document.getElementById("32a").checked || document.getElementById("33a").checked || document.getElementById("34a").checked || document.getElementById("35a").checked || document.getElementById("36a").checked || document.getElementById("37a").checked) {
			document.getElementById("id_motif").style = "color:black";
		}
		
		if($('.bfiche').is(":checked")) { 
            $(".fiche").hide();
			}
        else
            $(".fiche").show();
			
		if(document.getElementById("25a").checked)
            $(".cl_auteur_input_autre").show();
        else
            $(".cl_auteur_input_autre").hide();
			
		if($('.cl_b_pj_chk').is(":checked")) {
            $(".cl_pj").show();
			}
        else
            $(".cl_pj").hide();
    }
	
	function refuserToucheEntree(event)
{
    // Compatibilité IE / Firefox
    if(!event && window.event) {
        event = window.event;
    }
    // IE
    if(event.keyCode == 13) {
        event.returnValue = false;
        event.cancelBubble = true;
    }
    // DOM
    if(event.which == 13) {
        event.preventDefault();
        event.stopPropagation();
    }
}
</script>

<script>
	//ENVOI LES PIECES JOINTES SUR LE DRIVE
	
	function savePJ(fichier) {
        var file = fichier.files[0];
        var fr = new FileReader();
        fr.fileName = file.name;
        fr.onload = function(e) {
			var nbrData = document.getElementById("nbrData").value;
            e.target.result
            html = '<input type="hidden" name="data'+nbrData+'" value="' + e.target.result.replace(/^.*,/, '') + '" >';
            html += '<input type="hidden" name="mimetype'+nbrData+'" value="' + e.target.result.match(/^.*(?=;)/)[0] + '" >';
            html += '<input type="hidden" name="filename'+nbrData+'" value="' + e.target.fileName + '" >';
			
			var data = "#data"+nbrData;
            $(data).empty().append(html);
			
			nbrData++;
			$('#files').append('<br><div id="data'+nbrData+'"></div><input name="file'+nbrData+'" id="pj'+nbrData+'" type="file" onchange="savePJ(this)">')
			document.getElementById("nbrData").value = nbrData;
        }
        fr.readAsDataURL(file);
    }
</script>

<script type="text/javascript">
    $('#submit-form').on('click', function(e) {
		if(document.getElementById("25a").checked) {
			document.getElementById("25a").value = document.getElementById("25c").value;
		}
		
		var conditions = true;
	<!-- INFORMATIONS -->
		var bInfo = true;
		<!-- fiche -->
		if(!document.getElementById("id_bfiche").checked && document.getElementById("id_inp_fiche").value == "") bInfo = false;
		<!-- adresse -->
		if((document.getElementById("01a").checked || document.getElementById("03a").checked)&& document.getElementById("id_inp_adresse").value == "") bInfo = false;
		if(!bInfo) {
			conditions = false;
			document.getElementById("id_info").style = "color:red";
		}
	<!-- TYPE -->
		if(document.getElementById("01a").checked && !document.getElementById("11").checked && !document.getElementById("12").checked && !document.getElementById("13").checked && !document.getElementById("14").checked) {
			conditions = false;
			document.getElementById("id_type").style = "color:red";
		}
	<!-- AUTEUR -->
		if(document.getElementById("02a").checked && !document.getElementById("21a").checked && !document.getElementById("22a").checked && !document.getElementById("23a").checked && !document.getElementById("24a").checked && !document.getElementById("25a").checked) {
			conditions = false;
			document.getElementById("id_auteur").style = "color:red";
		}
	<!-- MOTIF -->
		if(document.getElementById("02a").checked && !document.getElementById("31a").checked && !document.getElementById("32a").checked && !document.getElementById("33a").checked && !document.getElementById("34a").checked && !document.getElementById("35a").checked && !document.getElementById("36a").checked && !document.getElementById("37a").checked) {
			conditions = false;
			document.getElementById("id_motif").style = "color:red";
		}
		if(conditions) {
			$('#production_form').submit();
			setTimeout(function() {
				$('#form_pj').submit();
			}, 1500);
		}
		else document.getElementById("id_titre").style = "color:red";
	});
</script>

</body>
</html>
